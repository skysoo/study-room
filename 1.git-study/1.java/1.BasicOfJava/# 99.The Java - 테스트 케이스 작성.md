# The Java - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±


> ì°¸ì¡° ì‚¬ì´íŠ¸ - https://docs.google.com/document/d/1j6mU7Q5gng1mAJZUKUVya4Rs0Jvn5wn_bCUp3rq41nQ/edit


## 1. JUnit5 ì‹œì‘

![JUNIT1](../99.Img/JUNIT1.png)

~~~java
@SpringBootTest
class JunitTestDemoApplicationTests {

    @Test
    void contextLoads() {
        App app = new App();
        assertNotNull(app);
        System.out.println("create");
    }

    @Test
    @Disabled
    void create1(){
        System.out.println("create1");
    }

    // ëª¨ë“  @Test ì½”ë“œê°€ ì‹¤í–‰ ë˜ê¸° ì „ì— ë”± í•œë²ˆ ì‹¤í–‰ ëœë‹¤.
    // private, default ì•ˆë¨
    @BeforeAll
    static void beforeAll(){
        System.out.println("beforeAll");
    }

    @AfterAll
    static void afterAll(){
        System.out.println("afterAll");
    }

    // ëª¨ë“  @Test ì½”ë“œê°€ ì‹¤í–‰ ë˜ê¸° ì•,ë’¤ì— í•œë²ˆì”© ì‹¤í–‰ ëœë‹¤.
    @BeforeEach
    void beforeEach(){
        System.out.println("beforeEach");
    }

    @AfterEach
    void afterEach(){
        System.out.println("afterEach");
    }
}
~~~

## 2. JUnit5 í…ŒìŠ¤íŠ¸ ì´ë¦„ í‘œì‹œí•˜ê¸°

~~~java
@SpringBootTest
@DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)
class JunitTestDemoApplicationTests {

  @Test
  @DisplayName("App ë§Œë“¤ê¸°")
  void create_new_app() {
      App app = new App();
      assertNotNull(app);
      System.out.println("create");
}
~~~

> @DisplayName() ì„ ì¶”ì²œí•œë‹¤.

## 3. JUnit5 Assertion

![JUNIT2](../99.Img/JUNIT2.png)

### 3.1 assertEquals
~~~java
@Test
@DisplayName("App ë§Œë“¤ê¸°ğŸ¥Š")
void create_new_app() {
    App app = new App();

    // Not Null ì²´í¬
    assertNotNull(app);

    // í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆì„ ë•Œ ë³´ì—¬ì§€ëŠ” ë©”ì‹œì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë°, ë‹¨ìˆœ String ë˜ëŠ” Lambdaë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

    // ë©”ì„¸ì§€ë¥¼ ë‹¨ìˆœ Stringìœ¼ë¡œ ë³´ë‚¼ ê²½ìš° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë¬¸ìì—´ì„ ë§Œë“ ë‹¤. í•­ìƒ
    assertEquals(AppStatus.DRAFT, app.getStatus(), "Appì„ ì²˜ìŒ ë§Œë“¤ë©´"+ AppStatus.DRAFT + " ìƒíƒœê°€ ë˜ì•¼ í•œë‹¤.");

    // ë°˜ë©´ ëŒë‹¤ë¡œ ì²˜ë¦¬í•´ë†“ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œì—ë§Œ ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
    assertEquals(AppStatus.DRAFT, app.getStatus(), () -> "Appì„ ì²˜ìŒ ë§Œë“¤ë©´"+ AppStatus.DRAFT + " ìƒíƒœê°€ ë˜ì•¼ í•œë‹¤.");
    }
~~~

### 3.2 assertAll
~~~java
@Test
@DisplayName("App ë§Œë“¤ê¸°ğŸ¥Š")
void create_new_app() {
    App app = new App(-10);

    // í…ŒìŠ¤íŠ¸ë¥¼ í•œë²ˆì— ë¬¶ì–´ì„œ ì‹¤í–‰í•´ì¤„ ìˆ˜ ìˆë‹¤.
    assertAll(
            () -> assertNotNull(app),
            () -> assertEquals(AppStatus.DRAFT, app.getStatus(), () -> "Appì„ ì²˜ìŒ ë§Œë“¤ë©´"+ AppStatus.DRAFT + " ìƒíƒœê°€ ë˜ì•¼ í•œë‹¤."),
            () -> assertTrue(app.getLimit() > 0, "App ìµœëŒ€ ì°¸ì„ ê°¯ìˆ˜ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•œë‹¤.")
    );
}
~~~

### 3.3 assertThrows
~~~java
@Test
@DisplayName("App ë§Œë“¤ê¸°ğŸ¥Š")
void create_new_app() {
    IllegalArgumentException exception = assertThrows(IllegalArgumentException.class, () -> new App(-10));

    String message = exception.getMessage();
    assertEquals("limitì€ 0ë³´ë‹¤ ì»¤ì•¼ í•œë‹¤.",message);

}
~~~

## 4. JUnit5 ì¡°ê±´ì— ë”°ë¼ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
~~~java
@Test
@DisplayName("App ë§Œë“¤ê¸°ğŸ¥Š")
// ê¸°ë™ ìš´ì˜ í™˜ê²½ì— ë”°ë¥¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¡°ê±´ ì§€ì •
@EnabledOnOs(OS.MAC)
// íŠ¹ì • ìë°” ë²„ì „ì—ì„œë§Œ í…ŒìŠ¤íŠ¸ë¥¼ ì„ íƒì ìœ¼ë¡œ ìˆ˜í–‰
@EnabledOnJre({JRE.JAVA_8,JRE.JAVA_9})
// í™˜ê²½ ë³€ìˆ˜ì˜ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ì¡°ê±´ë¬¸ ì§€ì •
@EnabledIfEnvironmentVariable(named = "TEST_ENV", matches = "local")
void create_new_app() {
    String test_env = System.getenv("TEST_ENV");
    System.out.println(test_env);
    assumeTrue("LOCAL".equalsIgnoreCase(test_env));

    App app = new App(-10);
    assertThat(app.getLimit()).isGreaterThan(0);

    assertTimeout(Duration.ofMillis(100),() -> {
        new App(10);
        Thread.sleep(50);
    },"í…ŒìŠ¤íŠ¸ê°€ 100msì„ ë„˜ê¸°ë©´ ì•ˆëœë‹¤.");
}
~~~


## 5. JUnit5 í…ŒìŠ¤íŠ¸ íƒœê¹…

![JUNIT3](../99.Img/JUNIT3.png)

### 5.1 JUnit5 íƒœê¹…
~~~java
@Tag("fast")
void create_new_app() { }
~~~

### 5.2 build íˆ´ íŠ¹ì • íƒœê¹…ë§Œ í…ŒìŠ¤íŠ¸
~~~java
<profiles>
// defaultë¡œ íŠ¹ì • íƒœê¹…ë§Œ í…ŒìŠ¤íŠ¸ í•˜ê² ë‹¤.
        <profile>
            <id>default</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <groups>fast</groups>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

// ciëŠ” ëª¨ë“  íƒœê¹…ì„ í…ŒìŠ¤íŠ¸ í•˜ê² ë‹¤.
        <profile>
            <id>ci</id>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <groups>fast | slow</groups>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
</profiles>


// terminal
Î» ./mvnw.cmd test -P ci
~~~

## 6. JUnit5 ì»¤ìŠ¤í…€ íƒœê·¸

~~~java
@Target(ElementType.METHOD)
@Test
@Tag("fast")
@Retention(RetentionPolicy.RUNTIME)
public @interface FastTest {
}
~~~

ì»¤ìŠ¤í…€ íƒœê·¸ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ @Tagì— (Stringìœ¼ë¡œ ê°’ì„ ì¼ì¼íˆ ë§¤í•‘í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.)

ì•„ë˜ ì½”ë“œëŠ” ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì— type-safetyí•˜ì§€ ì•Šë‹¤. íƒœê·¸ ë¬¸ìì—´ì— ì˜¤íƒ€ê°€ ìƒê¸°ë”ë¼ë„ ì¡ì•„ì£¼ì§€ ì•ŠëŠ”ë‹¤..

~~~java
@Tag("fast")
void create_new_app() { }
~~~

## 7. JUnit5 í…ŒìŠ¤íŠ¸ ë°˜ë³µí•˜ê¸°

### 7.1 ë‹¨ìˆœ ë°˜ë³µ í…ŒìŠ¤íŠ¸
~~~java
@DisplayName("ë°˜ë³µ í…ŒìŠ¤íŠ¸")
@RepeatedTest(value = 10, name = "{displayName}, {currentRepetition} / {totalRepetitions}")
void repeatTest(RepetitionInfo repetitionInfo){
    System.out.println("test" + repetitionInfo.getCurrentRepetition() + "/"
    + repetitionInfo.getTotalRepetitions());
}
~~~

### 7.2 ë‹¤ë¥¸ ì¸ìê°’ìœ¼ë¡œ ë°˜ë³µ í…ŒìŠ¤íŠ¸
~~~java
@DisplayName("ì¸ì ë°˜ë³µ í…ŒìŠ¤íŠ¸")
@ParameterizedTest(name = "{index} {displayName} message={0}")
@ValueSource(strings = {"ë‚ ì”¨ê°€","ë§ì´","ë”ì›Œì§€ê³ ","ìˆë„¤ìš”."})
// @EmptySource // ë¹„ì–´ìˆëŠ” ë¬¸ì ì¶”ê°€
// @NullSource // Null ë¬¸ì ì¶”ê°€
@NullAndEmptySource
void parameterizedTest(String message){
    System.out.println(message);
}
~~~

~~~java
@DisplayName("CVS Source ê°’")
@ParameterizedTest(name = "{index} {displayName} message={0}")
@ValueSource(ints = {10, 20, 40})
void parameterizedTest3(@ConvertWith(AppConverter.class) App app){
    System.out.println(app.getLimit());
}

static class AppConverter extends SimpleArgumentConverter{
    @Override
    protected Object convert(Object source, Class<?> targetType) throws ArgumentConversionException {
        assertEquals(App.class, targetType, "Can only convert to App");
        return new App(Integer.parseInt(source.toString()));
    }
}

@DisplayName("CVS Source ê°’1")
@ParameterizedTest(name = "{index} {displayName} message={0}")
@CsvSource({"10, ìë°” ìŠ¤í„°ë””, 20, ìŠ¤í”„ë§"})
void parameterizedTest4(Integer limit, String name){
    App app = new App(limit, name);
    System.out.println(app);
}

@DisplayName("CVS Source ê°’2")
@ParameterizedTest(name = "{index} {displayName} message={0}")
@CsvSource({"10, ìë°” ìŠ¤í„°ë””" ,"20, ìŠ¤í”„ë§"})
void parameterizedTest5(ArgumentsAccessor argumentsAccessor){
    App app = new App(argumentsAccessor.getInteger(0), argumentsAccessor.getString(1));
    System.out.println(app);
}

@DisplayName("CVS Source ê°’3")
@ParameterizedTest(name = "{index} {displayName} message={0}")
@CsvSource({"10, ìë°” ìŠ¤í„°ë””" ,"20, ìŠ¤í”„ë§"})
void parameterizedTest6(@AggregateWith(AppAggregator.class) App app){
    System.out.println(app);
}
~~~

## 8. JUnit5 Test Instance



